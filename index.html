<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AKAZA SERVICIOS - Cat√°logo</title>
  <style>
    :root{
      --bg:#0b0b0e;
      --muted:#b8b8c6;
      --text:#f4f4fb;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(32,201,151,.22), transparent 55%),
                  radial-gradient(900px 500px at 90% 10%, rgba(255,92,122,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 76px}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:18px 18px; border:1px solid var(--border); border-radius:var(--radius); background: rgba(18,18,26,.72);
      box-shadow: var(--shadow); backdrop-filter: blur(8px);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .brand-badge{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, rgba(32,201,151,.85), rgba(255,92,122,.85));
      box-shadow: 0 10px 25px rgba(32,201,151,.15);
    }
    h1{font-size:18px; margin:0}
    .subtitle{margin:2px 0 0; color:var(--muted); font-size:13px}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      border:1px solid var(--border); background: rgba(0,0,0,.25);
      padding:10px 12px; border-radius:999px; color:var(--text);
    }
    .search{min-width:240px; outline:none;}
    .tabs{display:flex; gap:10px; margin:18px 0 8px; flex-wrap:wrap}
    .tab{
      padding:10px 14px; border-radius:999px; border:1px solid var(--border);
      cursor:pointer; background: rgba(0,0,0,.18); color:var(--muted);
      user-select:none;
    }
    .tab.active{background: rgba(32,201,151,.16); border-color: rgba(32,201,151,.45); color:var(--text)}
    .grid{display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:14px; margin-top:12px;}
    @media (max-width: 900px){ .grid{grid-template-columns: repeat(2, minmax(0, 1fr));} }
    @media (max-width: 620px){ .grid{grid-template-columns: 1fr;} .search{min-width: 160px} }

    .card{
      background: rgba(18,18,26,.78); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow: var(--shadow);
      padding:16px; overflow:hidden; position:relative;
    }
    .badge{
      position:absolute; top:12px; right:12px;
      padding:6px 10px; border-radius:999px; font-size:12px;
      border:1px solid var(--border); background: rgba(0,0,0,.25); color: var(--muted);
    }

    .hero-logo{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px 0 2px;
    }
    .hero-logo .logo-box{
      width:108px; height:108px;
      border-radius:22px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      display:grid; place-items:center;
      overflow:hidden;
    }
    .hero-logo img{width:100%; height:100%; object-fit:contain}
    .hero-emoji{font-size:42px; line-height:1}

    .service-name{
      margin:10px 0 2px;
      font-size:17px;
      text-align:center;
      font-weight:800;
      letter-spacing:.2px;
    }
    .service-hint{
      text-align:center;
      color:var(--muted);
      font-size:12px;
      margin-bottom:10px;
    }

    .plans{margin-top:8px; display:flex; flex-direction:column; gap:8px}
    .plan{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 10px; border-radius:14px; border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      cursor:pointer;
    }
    .plan .meta{display:flex; flex-direction:column; gap:2px}
    .plan .meta span{font-size:12px; color:var(--muted)}
    .price{font-weight:800}

    .wa{
      margin-top:12px; width:100%;
      border:none; background: rgba(37,211,102,.18); color:var(--text);
      padding:12px; border-radius:14px; cursor:pointer; font-weight:800;
      border: 1px solid rgba(37,211,102,.45);
    }
    .wa:hover{background: rgba(37,211,102,.24)}

    .section{
      margin-top:18px; padding:16px 16px;
      border:1px solid var(--border); border-radius:var(--radius); background: rgba(18,18,26,.62);
    }
    .section h2{font-size:16px; margin:0 0 10px}
    .section ul{margin:0; padding-left:18px; color:var(--muted)}
    .small{font-size:12px; color:var(--muted)}

    .float-wa{
      position:fixed; right:16px; bottom:16px;
      width:56px; height:56px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(37,211,102,.92); color:#08240f; font-size:24px; font-weight:900;
      box-shadow: 0 18px 35px rgba(0,0,0,.45);
      cursor:pointer; border: none;
    }
    .float-wa:active{transform: translateY(1px)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="brand-badge" aria-hidden="true"></div>
        <div>
          <h1 id="businessName">Cat√°logo</h1>
          <div class="subtitle">Plataformas streaming, IA y software</div>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="pill search" placeholder="Buscar (Netflix, Spotify...)" />
      </div>
    </header>

    <div class="tabs" id="tabs"></div>

    <div class="grid" id="grid"></div>

    <div class="section">
      <h2>Informaci√≥n importante</h2>
      <ul id="infoImportante"></ul>
      <div class="small">*Tomado del PDF del cat√°logo.</div>
    </div>

    <div class="section">
      <h2>¬øQuieres ser distribuidor?</h2>
      <ul id="distribuidor"></ul>
      <div class="small">Escr√≠beme por WhatsApp para m√°s info.</div>
    </div>
  </div>

  <button class="float-wa" id="floatWA" title="WhatsApp">‚úÜ</button>

<script>
  const EMOJI = {
    "Streaming": "üé¨",
    "IA": "ü§ñ",
    "Software": "üíª"
  };

  async function loadData(){
    const res = await fetch("./data.json", {cache:"no-store"});
    return await res.json();
  }

  function waLink(number, text){
    const base = "https://wa.me/" + String(number || "").replace(/\D/g,"");
    const msg = encodeURIComponent(text || "");
    return msg ? (base + "?text=" + msg) : base;
  }

  function formatPrice(currency, price){
    if(price === null || price === undefined) return "Consultar";
    return `${currency}${price}`;
  }

  function buildMessage(tpl, item, plan, priceText){
    const msg = (tpl || "Hola, quiero pedir: {{service}} - {{plan}} ({{price}}).")
      .replaceAll("{{service}}", item.service)
      .replaceAll("{{plan}}", plan.name)
      .replaceAll("{{price}}", priceText);
    return msg;
  }

  function uniqueCategories(catalog){
    const s = new Set(catalog.map(x => x.category));
    return ["Todos", ...Array.from(s)];
  }

  function renderTabs(categories, active, onClick){
    const tabs = document.getElementById("tabs");
    tabs.innerHTML = "";
    categories.forEach(cat => {
      const b = document.createElement("div");
      b.className = "tab" + (cat === active ? " active" : "");
      b.textContent = cat;
      b.onclick = () => onClick(cat);
      tabs.appendChild(b);
    });
  }

  function renderInfo(listId, items){
    const ul = document.getElementById(listId);
    ul.innerHTML = "";
    (items || []).forEach(t => {
      const li = document.createElement("li");
      li.textContent = t;
      ul.appendChild(li);
    });
  }

  function slugify(name){
  return String(name || "")
    .toLowerCase()
    .trim()
    .replaceAll("+", "plus")
    .replace(/&/g, "and")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}

function slugify(name){
  return String(name || "")
    .toLowerCase()
    .trim()
    .replaceAll("+", "plus")
    .replaceAll("√°","a").replaceAll("√©","e").replaceAll("√≠","i").replaceAll("√≥","o").replaceAll("√∫","u").replaceAll("√±","n")
    .replace(/&/g, "and")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}

function makeHeroLogo(item){
  const wrap = document.createElement("div");
  wrap.className = "hero-logo";

  const box = document.createElement("div");
  box.className = "logo-box";

  const img = document.createElement("img");
  img.alt = (item.service || "") + " logo";
  img.loading = "lazy";

  // 1) Si existe item.logo √∫salo
  // 2) Si no, intenta autom√°ticamente: assets/<nombre-plataforma>.png
  const auto = `assets/${slugify(item.service)}.png`;

  // anti-cach√© (para que se vean de inmediato en GitHub Pages)
  img.src = (item.logo || auto) + "?v=" + Date.now();

  img.onerror = () => {
    box.innerHTML = `<div class="hero-emoji">${EMOJI[item.category] || "‚ú®"}</div>`;
  };

  box.appendChild(img);
  wrap.appendChild(box);
  return wrap;
}

  const wrap = document.createElement("div");
  wrap.className = "hero-logo";

  const box = document.createElement("div");
  box.className = "logo-box";

  const img = document.createElement("img");
  img.alt = (item.service || "") + " logo";
  img.loading = "lazy";

  // 1) si existe item.logo, √∫salo
  // 2) si no, intenta assets/<nombre-plataforma>.png
  const fallback = `assets/${slugify(item.service)}.png`;
  img.src = item.logo || fallback;

  img.onerror = () => {
    box.innerHTML = `<div class="hero-emoji">${EMOJI[item.category] || "‚ú®"}</div>`;
  };

  box.appendChild(img);
  wrap.appendChild(box);
  return wrap;
}

    const wrap = document.createElement("div");
    wrap.className = "hero-logo";

    const box = document.createElement("div");
    box.className = "logo-box";

    if(item.logo){
      const img = document.createElement("img");
      img.src = item.logo;
      img.alt = item.service + " logo";
      img.loading = "lazy";
      img.onerror = () => { box.innerHTML = "<div class='hero-emoji'>‚ú®</div>"; };
      box.appendChild(img);
    }else{
      const e = document.createElement("div");
      e.className = "hero-emoji";
      e.textContent = EMOJI[item.category] || "‚ú®";
      box.appendChild(e);
    }

    wrap.appendChild(box);
    return wrap;
  }

  function renderGrid(data, activeCat, query){
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    const q = (query || "").trim().toLowerCase();

    const filtered = (data.catalog || []).filter(item => {
      const matchCat = (activeCat === "Todos") || (item.category === activeCat);
      const hay = (item.service + " " + item.category + " " + (item.plans||[]).map(p=>p.name).join(" ")).toLowerCase();
      const matchQ = !q || hay.includes(q);
      return matchCat && matchQ;
    });

    filtered.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = item.category;
      card.appendChild(badge);

      card.appendChild(makeHeroLogo(item));

      const title = document.createElement("div");
      title.className = "service-name";
      title.textContent = item.service;
      card.appendChild(title);

      const hint = document.createElement("div");
      hint.className = "service-hint";
      hint.textContent = "Toca un plan para pedir por WhatsApp";
      card.appendChild(hint);

      const plans = document.createElement("div");
      plans.className = "plans";

      (item.plans || []).forEach(plan => {
        const row = document.createElement("div");
        row.className = "plan";

        const meta = document.createElement("div");
        meta.className = "meta";
        const name = document.createElement("div");
        name.textContent = plan.name;
        const tip = document.createElement("span");
        tip.textContent = "Pedido por WhatsApp";
        meta.appendChild(name);
        meta.appendChild(tip);

        const price = document.createElement("div");
        price.className = "price";
        const priceText = formatPrice(data.currency, plan.price);
        price.textContent = priceText;

        row.appendChild(meta);
        row.appendChild(price);

        row.onclick = () => {
          const msg = buildMessage(data.whatsapp_default_message, item, plan, priceText);
          window.open(waLink(data.whatsapp_number, msg), "_blank");
        };

        plans.appendChild(row);
      });

      card.appendChild(plans);

      const waBtn = document.createElement("button");
      waBtn.className = "wa";
      waBtn.textContent = "Pedir por WhatsApp";
      waBtn.onclick = () => {
        const msg = `Hola, quiero informaci√≥n del servicio: ${item.service}`;
        window.open(waLink(data.whatsapp_number, msg), "_blank");
      };
      card.appendChild(waBtn);

      grid.appendChild(card);
    });

    if(filtered.length === 0){
      const empty = document.createElement("div");
      empty.className = "section";
      empty.innerHTML = "<b>No encontr√© resultados.</b><br/><span class='small'>Prueba otro nombre o revisa la categor√≠a.</span>";
      grid.appendChild(empty);
    }
  }

  (async function init(){
    const data = await loadData();

    document.getElementById("businessName").textContent = data.business_name || "Cat√°logo";

    const categories = uniqueCategories(data.catalog || []);
    let activeCat = "Todos";
    let query = "";

    function onTab(cat){
      activeCat = cat;
      renderTabs(categories, activeCat, onTab);
      renderGrid(data, activeCat, query);
    }

    renderTabs(categories, activeCat, onTab);
    renderGrid(data, activeCat, query);

    renderInfo("infoImportante", data.sections?.info_importante || []);
    renderInfo("distribuidor", data.sections?.distribuidor || []);

    document.getElementById("search").addEventListener("input", (e)=>{
      query = e.target.value || "";
      renderGrid(data, activeCat, query);
    });

    document.getElementById("floatWA").onclick = () => {
      window.open(waLink(data.whatsapp_number, "Hola, quiero hacer un pedido."), "_blank");
    };
  })();
</script>
</body>
</html>
