<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AKAZA SERVICIOS - Cat√°logo</title>

<style>
:root{
  --bg:#0b0b0e;
  --card:#12121a;
  --muted:#b8b8c6;
  --text:#f4f4fb;
  --border:rgba(255,255,255,.10);
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

header{
  padding:20px;
  border:1px solid var(--border);
  border-radius:var(--radius);
  background:var(--card);
  box-shadow:var(--shadow);
  margin-bottom:20px;
}
h1{margin:0;font-size:22px}
.subtitle{color:var(--muted);font-size:13px}

.tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px}
.tab{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#00000055;
  color:var(--muted);
  cursor:pointer;
  font-size:13px;
}
.tab.active{
  background:#20c99733;
  border-color:#20c997;
  color:#fff;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}
@media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.grid{grid-template-columns:1fr}}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
}

.logo-box{
  width:120px;
  height:120px;
  margin:0 auto 10px;
  border-radius:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#00000055;
  overflow:hidden;
}
.logo-box img{
  width:85%;
  height:85%;
  object-fit:contain;
}

.service-name{
  text-align:center;
  font-weight:800;
  margin-bottom:6px;
}
.hint{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-bottom:10px;
}

.plan{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#00000044;
  cursor:pointer;
  margin-bottom:6px;
}
.price{font-weight:700}

.wa{
  margin-top:10px;
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid #25D366;
  background:#25D36633;
  color:#fff;
  font-weight:800;
  cursor:pointer;
}

.float-wa{
  position:fixed;
  right:16px;
  bottom:16px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:#25D366;
  color:#08240f;
  font-size:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  border:none;
  cursor:pointer;
  box-shadow:0 18px 35px rgba(0,0,0,.45);
}
</style>
</head>

<body>
<div class="wrap">
  <header>
    <h1 id="businessName">Cat√°logo</h1>
    <div class="subtitle">Plataformas streaming, IA y software</div>
  </header>

<!-- ‚úÖ INFO IMPORTANTE (ARRIBA) -->
  <div class="section" id="infoBox" style="display:none;">
    <h2>Informaci√≥n importante</h2>
    <ul id="infoList"></ul>
  </div>

  <!-- ‚úÖ CATEGOR√çAS + CAT√ÅLOGO -->
  <div class="tabs" id="tabs"></div>
  <div class="grid" id="grid"></div>

  <!-- ‚úÖ DISTRIBUIDORES (AL FINAL) -->
  <div class="section" id="distBox" style="display:none;">
    <h2>¬øQuieres ser distribuidor?</h2>
    <ul id="distList"></ul>
    <div class="note">Escr√≠beme por WhatsApp para m√°s info.</div>
  </div>
</div>

<button class="float-wa" id="floatWA">‚úÜ</button>

<script>
const EMOJI={Streaming:"üé¨",IA:"ü§ñ",Software:"üíª"};

/** convierte "Disney+ Premium" -> "disney-premium" (solo para fallback local) */
function slugify(name){
  return String(name||"")
    .toLowerCase()
    .trim()
    .replaceAll("+","")
    .replaceAll("√°","a").replaceAll("√©","e").replaceAll("√≠","i").replaceAll("√≥","o").replaceAll("√∫","u").replaceAll("√±","n")
    .replace(/[^a-z0-9]+/g,"-")
    .replace(/(^-|-$)/g,"");
}

/** 1) intentos locales (tus PNGs) por marca */
function localCandidates(service){
  const s=(service||"").toLowerCase();

  // usa EXACTAMENTE estos nombres en /assets/
  if(s.includes("netflix")) return ["assets/netflix.png"];
  if(s.includes("prime")) return ["assets/primevideo.png","assets/prime-video.png"];
  if(s.includes("hbo")) return ["assets/hbo.png","assets/hbo-max.png"];
  if(s.includes("disney")) return ["assets/disney.png","assets/disneyplus.png","assets/disney-plus.png"];
  if(s.includes("crunchyroll")) return ["assets/crunchyroll.png"];
  if(s.includes("paramount")) return ["assets/paramount.png","assets/paramountplus.png"];
  if(s.includes("iptv")) return ["assets/iptv-smarters-pro.png","assets/iptv.png"];
  if(s.includes("vix")) return ["assets/vix-premium.png","assets/vix.png"];
  if(s.includes("apple tv")) return ["assets/apple-tv-plus.png","assets/appletv.png"];
  if(s.includes("spotify")) return ["assets/spotify.png"];
  if(s.includes("youtube")) return ["assets/youtube.png"];
  if(s.includes("movistar tv")) return ["assets/movistar.png"];
  if(s.includes("chatgpt")) return ["assets/gpt.png"];
  if(s.includes("gemini")) return ["assets/gemini.png"];
  if(s.includes("canva")) return ["assets/canva.png"];
  if(s.includes("capcut")) return ["assets/capcut.png"];
  if(s.includes("office")) return ["assets/office.png"];
  if(s.includes("windows")) return ["assets/windows.png"];
  if(s.includes("eset")) return ["assets/eset.png"];
  if(s.includes("duolingo")) return ["assets/duolingo.png"];
  if(s.includes("playstation")) return ["assets/playstation.png"];

  // fallback gen√©rico por si subes m√°s logos
  return [`assets/${slugify(service)}.png`];
}

/** 2) intentos CDN (si no hay local) */
function cdnCandidates(service){
  const s=(service||"").toLowerCase();

  if(s.includes("netflix")) return ["netflix"];
  if(s.includes("hbo")) return ["hbomax","hbo"];
  if(s.includes("crunchyroll")) return ["crunchyroll"];
  if(s.includes("paramount")) return ["paramountplus","paramount"];
  if(s.includes("apple tv")) return ["appletv","appletvplus"];
  if(s.includes("spotify")) return ["spotify"];
    if(s.includes("youtube")) return ["assets/youtube.png"];
  if(s.includes("movistar tv")) return ["assets/movistar.png"];
  if(s.includes("chatgpt")) return ["assets/gpt.png"];
  if(s.includes("gemini")) return ["assets/gemini.png"];

  // estos pueden fallar seg√∫n el CDN, por eso van como √∫ltimo recurso
  if(s.includes("disney")) return ["disneyplus","disney"];
  if(s.includes("prime")) return ["primevideo","amazonprimevideo","amazonprime"];

  return [];
}

async function loadData(){
  const r=await fetch("./data.json",{cache:"no-store"});
  return await r.json();
}

function waLink(num,msg){
  return "https://wa.me/"+num+"?text="+encodeURIComponent(msg);
}

function renderLogo(box, item){
  const locals = localCandidates(item.service);
  const cdns   = cdnCandidates(item.service).map(x=>`https://cdn.simpleicons.org/${x}/ffffff`);

  // Lista final de intentos: primero local, luego CDN
  const tries = [...locals, ...cdns];

  // nada que intentar:
  if(!tries.length){
    box.textContent = EMOJI[item.category] || "‚ú®";
    return;
  }

  const img = document.createElement("img");
  img.alt = (item.service||"") + " logo";
  img.loading = "lazy";

  let i = 0;
  const tryNext = () => {
    if(i >= tries.length){
      box.textContent = EMOJI[item.category] || "‚ú®";
      return;
    }
    // anti-cache:
    const src = tries[i];
    img.src = src + (src.includes("?") ? "&" : "?") + "v=" + Date.now();
    i++;
  };

  img.onerror = tryNext;
  box.appendChild(img);
  tryNext();
}

function render(data){
  document.getElementById("businessName").textContent = data.business_name || "Cat√°logo";

  const cats=["Todos",...new Set((data.catalog||[]).map(i=>i.category))];
  let active="Todos";

  function drawTabs(){
    const t=document.getElementById("tabs");
    t.innerHTML="";
    cats.forEach(c=>{
      const b=document.createElement("div");
      b.className="tab"+(c===active?" active":"");
      b.textContent=c;
      b.onclick=()=>{active=c;drawTabs();drawGrid();};
      t.appendChild(b);
    });
  }

  function drawGrid(){
    const g=document.getElementById("grid");
    g.innerHTML="";

    (data.catalog||[])
      .filter(i=>active==="Todos"||i.category===active)
      .forEach(item=>{
        const card=document.createElement("div");
        card.className="card";

        const box=document.createElement("div");
        box.className="logo-box";
        renderLogo(box, item);
        card.appendChild(box);

        const n=document.createElement("div");
        n.className="service-name";
        n.textContent=item.service;
        card.appendChild(n);

        const h=document.createElement("div");
        h.className="hint";
        h.textContent="Toca un plan para pedir por WhatsApp";
        card.appendChild(h);

        (item.plans||[]).forEach(p=>{
          const row=document.createElement("div");
          row.className="plan";
          row.innerHTML=`<div>${p.name}</div><div class="price">${p.price?data.currency+p.price:"Consultar"}</div>`;
          row.onclick=()=>{
            window.open(
              waLink(
                data.whatsapp_number,
                `Hola, quiero pedir: ${item.service} - ${p.name} (${p.price?data.currency+p.price:"Consultar"})`
              )
            );
          };
          card.appendChild(row);
        });

        const wa=document.createElement("button");
        wa.className="wa";
        wa.textContent="Pedir por WhatsApp";
        wa.onclick=()=>window.open(waLink(data.whatsapp_number,`Hola, quiero informaci√≥n de ${item.service}`));
        card.appendChild(wa);

        g.appendChild(card);
      });
  }

  drawTabs();
  drawGrid();

  document.getElementById("floatWA").onclick=()=>{
    window.open(waLink(data.whatsapp_number,"Hola, quiero hacer un pedido."));
  };
}

loadData().then(render);
</script>
</body>
</html>
